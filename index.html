<!DOCTYPE html>
	<head>
        <meta charset="UTF-8" />
		<title>The simplest chat there is</title>
        <script src="/socket.io/socket.io.js"></script>
	</head>
	<body>
        <div id="chatWindow"></div>
        <span id="myNick"></span> <input id="message"  type='text' name='message' value="" />
        <button id='send'>Send</button>
        <button id='setNick'>Set nick</button>

        <script>
            var socket = io.connect('http://localhost');

            document.getElementById("send").onclick = function(event) {
                var message = document.getElementById("message").value;
                console.log("sendMessage called with:" + JSON.stringify(message));

                // TODO: Broadcast to everyone, including myself
                socket.emit('chat', {message: message} );
                // TODO: Why's send not working?
            }

            function setNick(nick) {
                socket.emit('setNick', nick );
                document.getElementById("myNick").innerHTML = nick;
            }

            document.getElementById("setNick").onclick = function(event) {
                setNick(document.getElementById("message").value);
            }

            socket.on('message', function (data) {
                // Could be jQuery, like: $("#chatWindow").append("<div>" + data.id +" "+ data.message +"</div>");

                var div = document.createElement("div");
                div.className = "message";
                div.innerHTML = data.client +": "+ data.message;

                document.getElementById("chatWindow").appendChild(div);
		    });
        </script>
	</body>
</html>
